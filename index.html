
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Memory Pattern Game</title>
  <style>
    body { margin: 0; font-family: sans-serif; background: #000; color: #0f0; display: flex; flex-direction: column; align-items: center; }
    canvas { background: #111; margin-top: 10px; }
    .controls { display: flex; gap: 10px; margin-top: 10px; }
    button { padding: 10px 20px; background: #222; color: #0f0; border: 1px solid #0f0; }
    .info { margin-top: 10px; }
  </style>
</head>
<body>
  <h1>Memory Pattern Game</h1>
  <div class="info">
    <div>Level: <span id="level">1</span></div>
    <div>Highest Level: <span id="highLevel">1</span></div>
  </div>
  <div class="controls">
    <button id="togglePattern">Toggle Pattern</button>
    <button id="restart">Restart</button>
  </div>
  <canvas id="gameCanvas" width="300" height="300"></canvas>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const gridSize = 3;
    const tileSize = canvas.width / gridSize;
    const toggleBtn = document.getElementById('togglePattern');
    const restartBtn = document.getElementById('restart');
    const levelLabel = document.getElementById('level');
    const highLevelLabel = document.getElementById('highLevel');

    let currentLevel = 1;
    let highLevel = localStorage.getItem('highLevel') || 1;
    let pattern = [];
    let revealed = false;
    let selected = [];
    let shownPatterns = new Set();

    highLevelLabel.textContent = highLevel;

    function generatePattern(level) {
      let count = Math.min(level + 2, gridSize * gridSize - 1);
      let available = [];
      for (let i = 0; i < gridSize * gridSize; i++) available.push(i);

      let patternStr;
      do {
        pattern = [];
        let temp = [...available];
        for (let i = 0; i < count; i++) {
          let idx = Math.floor(Math.random() * temp.length);
          pattern.push(temp[idx]);
          temp.splice(idx, 1);
        }
        patternStr = pattern.sort((a,b) => a - b).join(',');
      } while (shownPatterns.has(patternStr));

      shownPatterns.add(patternStr);
      if (shownPatterns.size > 10) shownPatterns.clear(); // Reset after some levels
    }

    function drawGrid() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let i = 0; i < gridSize; i++) {
        for (let j = 0; j < gridSize; j++) {
          const index = i * gridSize + j;
          ctx.fillStyle = selected.includes(index) ? '#0f0' : '#333';
          if (revealed && pattern.includes(index)) {
            ctx.fillStyle = '#0ff';
          }
          ctx.fillRect(j * tileSize, i * tileSize, tileSize - 2, tileSize - 2);
        }
      }
    }

    function checkWin() {
      if (selected.length === pattern.length && selected.every(i => pattern.includes(i))) {
        currentLevel++;
        if (currentLevel > highLevel) {
          highLevel = currentLevel;
          localStorage.setItem('highLevel', highLevel);
          highLevelLabel.textContent = highLevel;
        }
        levelLabel.textContent = currentLevel;
        selected = [];
        generatePattern(currentLevel);
        drawGrid();
      }
    }

    canvas.addEventListener('click', e => {
      if (revealed) return;
      const x = Math.floor(e.offsetX / tileSize);
      const y = Math.floor(e.offsetY / tileSize);
      const index = y * gridSize + x;
      if (!selected.includes(index)) {
        selected.push(index);
        drawGrid();
        checkWin();
      }
    });

    toggleBtn.addEventListener('click', () => {
      revealed = !revealed;
      drawGrid();
    });

    restartBtn.addEventListener('click', () => {
      currentLevel = 1;
      levelLabel.textContent = currentLevel;
      selected = [];
      shownPatterns.clear();
      generatePattern(currentLevel);
      drawGrid();
    });

    generatePattern(currentLevel);
    drawGrid();
  </script>
</body>
</html>
